{% extends "admin/change_list.html" %}
{% load i18n admin_urls %}

{% block object-tools-items %}
<li>
    <a href="?{{ request.GET.urlencode }}&export=excel" class="btn btn-success"
        style="background-color: #28a745; color: white;">
        <i class="fas fa-file-excel"></i> Exportar Excel
    </a>
</li>
<li>
    <a href="?{{ request.GET.urlencode }}&export=pdf" class="btn btn-danger"
        style="background-color: #dc3545; color: white; margin-left: 10px;">
        <i class="fas fa-file-pdf"></i> Exportar PDF
    </a>
</li>
{{ block.super }}

<!-- Loading Spinner Overlay -->
<div id="loading-overlay"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.7); z-index:9999; justify-content:center; align-items:center;">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="sr-only">Cargando...</span>
    </div>
    <div style="margin-left: 20px; font-size: 1.5em; font-weight: bold; color: #333;">Procesando, por favor espere...
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var overlay = document.getElementById('loading-overlay');

        function showLoading() {
            overlay.style.display = 'flex';
        }

        // 1. Botones de Exportación
        var exportBtns = document.querySelectorAll('.btn-success, .btn-danger');
        exportBtns.forEach(function (btn) {
            btn.addEventListener('click', showLoading);
        });

        // 2. Filtros y Búsqueda (Formulario)
        var changelistForm = document.getElementById('changelist-form');
        if (changelistForm) {
            changelistForm.addEventListener('submit', showLoading);
        }
        // Jazzmin/Django filters might use links or distinct forms. 
        // Catch links in filter sidebar if they exist
        var filterLinks = document.querySelectorAll('#changelist-filter a');
        filterLinks.forEach(function (link) {
            link.addEventListener('click', showLoading);
        });

        // 3. Paginación
        var pageLinks = document.querySelectorAll('.pagination a, .paginator a');
        pageLinks.forEach(function (link) {
            link.addEventListener('click', showLoading);
        });

        // 4. Búsqueda directa (input submit)
        var searchForm = document.querySelector('#changelist-search form');
        if (searchForm) {
            searchForm.addEventListener('submit', showLoading);
        }
    });
</script>
{% endblock %}