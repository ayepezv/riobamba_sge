# -*- coding: utf-8 -*-
##############################################################################
#
# mario chogllo
#
##############################################################################
from gt_tool import XLSWriter
from time import strftime, strptime
from tools import ustr
from osv import osv, fields
import xlrd
import StringIO
import base64
from tools import ustr
import unicodedata
from string import upper
from datetime import datetime


class budgetLotaip(osv.TransientModel):
    _name = 'budget.lotaip'
    _columns = dict(
        poa_id = fields.many2one('budget.poa','Presupuesto'),
        date_from = fields.date('Fecha Desde'),
        date_to = fields.date('Fecha Hasta'),
        datas = fields.binary('Archivo'),
        datas_fname = fields.char('Nombre archivo', size=128),
    )


    def _get_totales(self,cr, uid, ids):
        res = { }
        res_line = { }
        context = { }
        context2 = {}
        result = []
        period_obj = self.pool.get('account.period')
        for this in self.browse(cr, uid, ids):
            date_from = this.date_from
            date_to = this.date_to
            poa_id = this.poa_id.id
            #program_id = this.program_id.id
        c_b_lines_obj = self.pool.get('budget.item')
        now = datetime.now()
        time = now.strftime("%Y-%m-%d")
        ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',poa_id),('type_budget','=','gasto')])
#        ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',poa_id),('type_budget','=','gasto'),('program_id','=',2)])
        context = {'by_date':True,'date_start': date_from, 'date_end': date_to,'poa_id':poa_id}    #TODO
        ##sacar el contexto dos para saber el mensual
        period_ids = period_obj.search(cr, uid, [('date_start','<=',date_to),('date_stop','>=',date_to)])
        periodo = period_obj.browse(cr, uid, period_ids[0])
        context2 = {'by_date':True,'date_start': periodo.date_start, 'date_end': periodo.date_stop,'poa_id':poa_id}  #SOLO EL MES                    
        planned_total=coded_total=reforma_total=balance_accured_total=practical_total=recaudado_total=0
        aux_1 = 0
        for line in c_b_lines_obj.browse(cr,uid,ids_lines, context=context):
            aux_1+=1
#            line2 = c_b_lines_obj.browse(cr,uid,line.id, context=context2)
            line2 = c_b_lines_obj.read(cr,uid,line.id,['commited_amount','reserved_amount','devengado_amount','paid_amount'], context=context2)
            #import pdb
            #pdb.set_trace()
            aux_commited = line2['commited_amount']
            aux_certificado = line2['reserved_amount']
            aux_devengado = line2['devengado_amount']
            aux_pagado = line2['paid_amount']
            if res_line.has_key(line.code_aux[0:6])==False:
                if res_line.has_key(line.budget_post_id.code[0:6])==False:
                    res_line[line.budget_post_id.code[0:6]]={
                        'post': line.budget_post_id,
                        'program': line.program_id.id,
                        'padre': False, 
                        'code': line.budget_post_id.code[0:6],
                        'general_budget_name':line.budget_post_id.name,
                        'planned_amount':line.planned_amount,
                        'commited_amount_mes':aux_commited,
                        'commited_amount':line.commited_amount,
                        'devengado_amount_mes':aux_devengado,
                        'devengado_amount':round(line.devengado_amount,2),
                        'paid_amount_mes':aux_pagado,
                        'paid_amount':round(line.paid_amount,2),
                        'devengado_balance':line.devengado_balance,
                        'commited_balance':line.commited_balance,
                        'codif_amount':line.codif_amount,
                        'reserved_amount':aux_certificado,
                        'reform_amount':line.reform_amount,
                        'final': True,
                        'tipo': line.type_budget,
                    }
                else:
                    res_line[line.budget_post_id.code[0:6]]['planned_amount']+=line.planned_amount
                    res_line[line.budget_post_id.code[0:6]]['reform_amount']+=line.reform_amount
                    res_line[line.budget_post_id.code[0:6]]['codif_amount']+=line.codif_amount
                    res_line[line.budget_post_id.code[0:6]]['commited_amount_mes']+=aux_commited
                    res_line[line.budget_post_id.code[0:6]]['commited_amount']+=line.commited_amount
                    res_line[line.budget_post_id.code[0:6]]['reserved_amount']+=aux_certificado
                    res_line[line.budget_post_id.code[0:6]]['devengado_amount_mes']+=aux_devengado
                    res_line[line.budget_post_id.code[0:6]]['devengado_amount']+=round(line.devengado_amount,2)
                    res_line[line.budget_post_id.code[0:6]]['paid_amount_mes']+=aux_pagado
                    res_line[line.budget_post_id.code[0:6]]['paid_amount']+=round(line.paid_amount,2)
                    res_line[line.budget_post_id.code[0:6]]['commited_balance']+=line.commited_balance
                    res_line[line.budget_post_id.code[0:6]]['devengado_balance']+=line.devengado_balance
            else:   
                res_line[line.code_aux[0:6]]['planned_amount']+=line.planned_amount
                res_line[line.code_aux[0:6]]['reform_amount']+=line.reform_amount
                res_line[line.code_aux[0:6]]['codif_amount']+=line.codif_amount
                res_line[line.code_aux[0:6]]['commited_amount_mes']+=aux_commited
                res_line[line.code_aux[0:6]]['commited_amount']+=line.commited_amount
                res_line[line.code_aux[0:6]]['reserved_amount']+=aux_certificado
                res_line[line.code_aux[0:6]]['devengado_amount_mes']+=aux_devengado
                res_line[line.code_aux[0:6]]['devengado_amount']+=round(line.devengado_amount,2)
                res_line[line.code_aux[0:6]]['paid_amount_mes']+=aux_pagado
                res_line[line.code_aux[0:6]]['paid_amount']+=round(line.paid_amount,2)
                res_line[line.code_aux[0:6]]['commited_balance']+=line.commited_balance
                res_line[line.code_aux[0:6]]['devengado_balance']+=line.devengado_balance
        return res_line
    
    def computeBudgetLotaip(self,cr, uid, ids,context):
        c_b_lines_obj = self.pool.get('budget.item')
        post_obj = self.pool.get('budget.post')
        post_ids = post_obj.search(cr, uid, [('nivel','=',3)])
        lista_partidas = {}
        if post_ids:
            for post_id in post_ids:
                post = post_obj.browse(cr, uid, post_id)
                lista_partidas[post.code]=(post.name.replace(',','')).replace(';','')
        for resumen in self.browse(cr, uid, ids):
            bufp = StringIO.StringIO()
            cabecera_budget = 'Cuenta' + ';' + 'Categoria' + ';' + 'Descripcion' + ';' + 'Asignado' + ';' + 'Modificado' + ';' + 'Codificado' + ';' + 'Certificado' + ';' + 'Comprometido' + ';' + 'Devengado' + ';' + 'Pagado' + ';' + 'Saldo por comprometer' + ';' + 'Saldo por Devengar' + ';' + 'Saldo por pagar' + ';' + 'Porcentaje de Ejecucion' +'\r\n'
            bufp.write(upper(cabecera_budget))
            res=self._get_totales(cr, uid, ids)
            result_dic=res.values()
            import operator
            dic_ord=sorted(result_dic, key=operator.itemgetter('code'))
#            import pdb
#            pdb.set_trace()
            for values in dic_ord:
                saldo_comprometer = saldo_devengar = saldo_pagar = aux_porcentaje = 0
                #if values['planned_amount']>0 or values['codif_amount']>0:
                if values['codif_amount']>0:
                    aux_porcentaje = (round(values['devengado_amount_mes'],2)*100.00)/round(values['codif_amount'],2)
                #print "aux_porcentajeeee", aux_porcentaje
                saldo_comprometer = values['codif_amount'] - values['commited_amount']
                saldo_devengar = values['codif_amount'] - values['devengado_amount']
                saldo_pagar = values['commited_amount'] - values['devengado_amount']
                aux_name = (values['general_budget_name'].replace(',','')).replace(';','')
                detallep = values['code'] + ';' + lista_partidas[values['code'][0:2]] + ';' + aux_name + ';' + str(values['planned_amount'])  + ';' + str(values['reform_amount']) + ';' + str(values['codif_amount']) + ';' + str(values['reserved_amount']) + ';' + str(values['commited_amount_mes']) + ';' + str(values['devengado_amount_mes']) + ';' + str(values['paid_amount_mes']) + ';' + str(saldo_comprometer) + ';' + str(saldo_devengar) + ';' + str(round(saldo_pagar,2)) + ';' + str(round(aux_porcentaje,2)) + '\r\n'
                detallep = unicodedata.normalize('NFKD',detallep).encode('ascii','ignore')
                bufp.write(upper(detallep))
            namep = "%s.csv" % ("CedulaLotaip-"+resumen.date_to)
            outp = base64.encodestring(bufp.getvalue())
            self.write(cr, uid, ids, {'datas': outp, 'datas_fname': namep})
            bufp.close()
            return True

    def computeBudgetLotaip2(self,cr, uid, ids,context):
        c_b_lines_obj = self.pool.get('budget.item')
        post_obj = self.pool.get('budget.post')
        post_ids = post_obj.search(cr, uid, [('nivel','=',3)])
        lista_partidas = {}
        if post_ids:
            for post_id in post_ids:
                post = post_obj.browse(cr, uid, post_id)
                lista_partidas[post.code]=post.name
        for resumen in self.browse(cr, uid, ids):
            bufp = StringIO.StringIO()
            cabecera_budget = 'Cuenta' + ';' + 'Categoria' + ';' + 'Descripcion' + ';' + 'Asignado' + ';' + 'Modificado' + ';' + 'Codificado' + ';' + 'Certificado' + ';' + 'Comprometido' + ';' + 'Devengado' + ';' + 'Pagado' + ';' + 'Saldo por comprometer' + ';' + 'Saldo por Devengar' + ';' + 'Saldo por pagar' + ';' + 'Porcentaje de Ejecucion' +'\r\n'
            bufp.write(upper(cabecera_budget))
            fecha_inicio = resumen.poa_id.date_start
            date_from = resumen.date_from
            date_to = resumen.date_to
            ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',resumen.poa_id.id),('type_budget','=','gasto')])
            context = {'by_date':True,'date_start': date_from, 'date_end': date_to,'poa_id':resumen.poa_id.id}
            context1 = {'by_date':True,'date_start': fecha_inicio, 'date_end': date_to,'poa_id':resumen.poa_id.id}
            planned_total=coded_total=reforma_total=balance_accured_total=practical_total=recaudado_total=0
            for line in c_b_lines_obj.browse(cr,uid,ids_lines, context=context1):
                line2 = line#c_b_lines_obj.browse(cr,uid,line.id, context=context1)
                aux_codificado = line2.codif_amount
                aux_pagado_final = line2.paid_amount
                aux_saldo_pagar = aux_codificado - aux_pagado_final
                if aux_codificado ==0:
                    aux_codificado = 1
                aux_porcentaje = 0
                if aux_pagado_final>0:
                    aux_porcentaje = (aux_pagado_final * 100)/aux_codificado
                aux_name = (line.name.replace(',','')).replace(';','')
                detallep = line.code + ';' + lista_partidas[line.budget_post_id.code[0:2]] + ';' + aux_name + ';' + str(line.planned_amount)  + ';' + str(line.reform_amount) + ';' + str(line.codif_amount) + ';' + str(line2.reserved_amount) + ';' + str(line2.commited_amount) + ';' + str(line2.devengado_amount) + ';' + str(line2.paid_amount) + ';' + str(line2.commited_balance) + ';' + str(line2.devengado_balance) + ';' + str(aux_saldo_pagar) + ';' + str(aux_porcentaje) + '\r\n'
                detallep = unicodedata.normalize('NFKD',detallep).encode('ascii','ignore')
                bufp.write(upper(detallep))
            namep = "%s.csv" % ("CedulaLotaip-"+resumen.date_to)
            outp = base64.encodestring(bufp.getvalue())
            self.write(cr, uid, ids, {'datas': outp, 'datas_fname': namep})
            bufp.close()
            return True
    
    
budgetLotaip()

class cedulaCodificado(osv.TransientModel):
    _name = 'cedula.codificado'
    _columns = dict(
        poa_id = fields.many2one('budget.poa','Presupuesto'),
        date_from = fields.date('Fecha Desde'),
        date_to = fields.date('Fecha Hasta'),
        datas = fields.binary('Archivo'),
        datas_fname = fields.char('Nombre archivo', size=128),
    )

    def crear_padre(self, data, data_suma, res):
        if data['post'].parent_id:
            data['padre'] = data['post'].parent_id
            if res.get(data['post'].parent_id.code,False):
                res[data['post'].parent_id.code]['planned_amount'] += data_suma['planned_amount']
                res[data['post'].parent_id.code]['codif_amount'] += data_suma['codif_amount']
            else:
                res[data['post'].parent_id.code] = {
                    'post': data['post'].parent_id,
                    'padre': False, 
                    'code':data['post'].parent_id.code,
                    'code_aux':data['post'].parent_id.code,
                    'general_budget_name':data['post'].parent_id.name,
                    'planned_amount':data['planned_amount'],
                    'codif_amount':data['codif_amount'],
                    'final': False,
                    'nivel': data['post'].parent_id.nivel-1,
                }
            self.crear_padre(res[data['post'].parent_id.code], data_suma,res)
            
    def _get_totales(self,cr, uid, ids):
        res = { }
        res_line = { }
        context = { }
        result = []
        period_obj = self.pool.get('account.period')
        for resumen in self.browse(cr, uid, ids):
            date_from = resumen.date_from
            date_to = resumen.date_to
        c_b_lines_obj = self.pool.get('budget.item')
        ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',resumen.poa_id.id),('type_budget','=','ingreso')])
        context = {'by_date':True,'date_start': date_from, 'date_end': date_to,'poa_id':resumen.poa_id.id}            
        planned_total=coded_total=reforma_total=balance_accured_total=practical_total=recaudado_total=0
        #        totales = c_b_lines_obj._compute_budget_all(self.cr, self.uid, ids_lines,[],[], context)
        for line in c_b_lines_obj.browse(cr,uid,ids_lines, context=context):
            if res_line.has_key(line.code)==False:
                code_aux = line.budget_post_id.code + '.' + line.program_id.sequence
                res_line[line.code]={
                    'post': line.budget_post_id,
                    'padre': False, 
                   # 'code':line.code,
                    'code':code_aux,#line.code_report,#line.code
                    'code_aux':code_aux,#line.code_report,
                    'general_budget_name':line.budget_post_id.name,
                    'planned_amount':line.planned_amount,
                    'codif_amount':line.codif_amount,
                    'nivel': line.budget_post_id.nivel-1,
                    'final': True,
                }
                if res_line.has_key(line.budget_post_id.code)==False:
                    code_aux = line.budget_post_id.code + '.' +line.program_id.sequence
                    res_line[line.budget_post_id.code]={
                        'post': line.budget_post_id,
                        'program': line.program_id.id,
                        'padre': False, 
                        'code': line.budget_post_id.code,
                        'code_aux':line.budget_post_id.code,
                        'general_budget_name':line.budget_post_id.name,
                        'planned_amount':line.planned_amount,
                        'codif_amount':line.codif_amount,
                        'final': True,
                        'nivel': line.budget_post_id.nivel-1,
                        'level': line.budget_post_id.nivel-1,
                    }
 #               else:
 #                   res_line[line.budget_post_id.code]['planned_amount']+=line.planned_amount
                self.crear_padre(res_line[line.code], res_line[line.code],res_line)
            else:                                
                res_line[line.budget_post_id.id+line.program_id.id]['planned_amount']+=line.planned_amount
        res_line['total']={'planned_amount': 0.00,
                           'codif_amount': 0.00,
                           'level':0,
                           'nivel':0,
                           'code':0,
                           'code_aux':0,
        }
        values=res_line.itervalues()
        for line_totales in values:
            if not 'level' in line_totales and line_totales['final']==True:
                res_line['total']['planned_amount']+=line_totales['planned_amount']
                res_line['total']['codif_amount']+=line_totales['codif_amount']        
        return res_line
    
    
    def export_report(self, cr, uid, ids, context=None):
        for this in self.browse(cr, uid, ids):
            writer = XLSWriter.XLSWriter()
            writer.append(['CEDULA CODIFICADO INGRESOS'])
            writer.append(['DESDE',this.date_from,'HASTA',this.date_to])
            writer.append(['PARTIDA','DENOMINACION','CODIFICADO'])
            res=self._get_totales(cr, uid, ids)
            result_dic=res.values()
            import operator
            dic_ord=sorted(result_dic, key=operator.itemgetter('code_aux'))
            for values in dic_ord:
                if values.has_key('general_budget_name'):
                    writer.append([values['code'],values['general_budget_name'],values['codif_amount']])
        writer.save("cedulaCodificado.xls")
        out = open("cedulaCodificado.xls","rb").read().encode("base64")
        self.write(cr, uid, ids, {'datas': out, 'datas_fname': 'cedulaCodificado.xls'})
        return True
            
    def print_report(self, cr, uid, ids, context=None):
        '''
        cr: cursor de la base de datos
        uid: ID de usuario
        ids: lista ID del objeto instanciado
        '''        
        if context is None:
            context = {}     
        poa_obj = self.pool.get('budget.poa')
        reporte = self.browse(cr, uid, ids, context)[0]
        datas = {'ids': [reporte.id], 'model': 'cedula.codificado'}
        return {
            'type': 'ir.actions.report.xml',
            'report_name': 'cedula_codificado',
            'model': 'cedula.codificado',
            'datas': datas,
            'nodestroy': True,                        
            }
    
cedulaCodificado()


class cedulaCodificadoGasto(osv.TransientModel):
    _name = 'cedula.codificado.gasto'
    _columns = dict(
        poa_id = fields.many2one('budget.poa','Presupuesto'),
        program_id = fields.many2one('project.program','Programa'),
        date_from = fields.date('Fecha Desde'),
        date_to = fields.date('Fecha Hasta'),
        datas = fields.binary('Archivo'),
        datas_fname = fields.char('Nombre archivo', size=128),
    )

    def _get_total_funcion(self,cr, uid, ids, programa,poa):
        line_obj = self.pool.get('budget.poa.funcion')
        line_ids = line_obj.search(cr,uid,[('funcion','=',programa.sequence[0]),('p_id','=',poa.id)])
        aux = 0
        if line_ids:
            line = line_obj.browse(cr, uid, line_ids[0])
            aux = line.total
        return aux

    def _get_total_codif(self,cr, uid, ids, programa,poa):
        res = { }
        res_line = { }
        context = { }
        result = []
        period_obj = self.pool.get('account.period')
        for resumen in self.browse(cr, uid, ids):
            date_from = resumen.date_from
            date_to = resumen.date_to
        c_b_lines_obj = self.pool.get('budget.item')
        ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',resumen.poa_id.id),('type_budget','=','gasto')])
        context = {'by_date':True,'date_start': date_from, 'date_end': date_to,'poa_id':resumen.poa_id.id}            
        aux_total_presupuesto = 0
        for line in c_b_lines_obj.browse(cr,uid,ids_lines, context=context):
            aux_total_presupuesto += line.codif_amount
        return aux

    def crear_padre(self, data, data_suma, res):
        if data['post'].parent_id:
            data['padre'] = data['post'].parent_id
            if res.get(data['post'].parent_id.code,False):
                res[data['post'].parent_id.code]['planned_amount'] += data_suma['planned_amount']
                res[data['post'].parent_id.code]['codif_amount'] += data_suma['codif_amount']
            else:
                res[data['post'].parent_id.code] = {
                    'post': data['post'].parent_id,
                    'padre': False, 
                    'code':data['post'].parent_id.code,
                    'code_aux':data['post'].parent_id.code,
                    'general_budget_name':data['post'].parent_id.name,
                    'planned_amount':data['planned_amount'],
                    'codif_amount':data['codif_amount'],
                    'final': False,
                    'nivel': data['post'].parent_id.nivel-1,
                }
            self.crear_padre(res[data['post'].parent_id.code], data_suma,res)
            
    def _get_totales(self,cr, uid, ids):
        res = { }
        res_line = { }
        context = { }
        result = []
        period_obj = self.pool.get('account.period')
        for resumen in self.browse(cr, uid, ids):
            date_from = resumen.date_from
            date_to = resumen.date_to
        c_b_lines_obj = self.pool.get('budget.item')
        ids_lines=c_b_lines_obj.search(cr,uid,[('poa_id','=',resumen.poa_id.id),('type_budget','=','gasto')])
#        ids_lines=c_b_lines_obj.search(cr,uid,[('program_id','=',resumen.program_id.id),('poa_id','=',resumen.poa_id.id),('type_budget','=','gasto')])
        context = {'by_date':True,'date_start': date_from, 'date_end': date_to,'poa_id':resumen.poa_id.id}            
        planned_total=coded_total=reforma_total=balance_accured_total=practical_total=recaudado_total=0
        #        totales = c_b_lines_obj._compute_budget_all(self.cr, self.uid, ids_lines,[],[], context)
        for line in c_b_lines_obj.browse(cr,uid,ids_lines, context=context):
            aux_total_presupuesto += line.codif_amount
            if not line.program_id.id==resumen.program_id.id:
                continue
            if res_line.has_key(line.code)==False:
                code_aux = line.budget_post_id.code + '.' + line.program_id.sequence
                res_line[line.code]={
                    'post': line.budget_post_id,
                    'padre': False, 
                   # 'code':line.code,
                    'code':code_aux,#line.code_report,#line.code
                    'code_aux':code_aux,#line.code_report,
                    'general_budget_name':line.budget_post_id.name,
                    'planned_amount':line.planned_amount,
                    'codif_amount':line.codif_amount,
                    'nivel': line.budget_post_id.nivel-1,
                    'final': True,
                }
                if res_line.has_key(line.budget_post_id.code)==False:
                    code_aux = line.budget_post_id.code + '.' +line.program_id.sequence
                    res_line[line.budget_post_id.code]={
                        'post': line.budget_post_id,
                        'program': line.program_id.id,
                        'padre': False, 
                        'code': line.budget_post_id.code,
                        'code_aux':line.budget_post_id.code,
                        'general_budget_name':line.budget_post_id.name,
                        'planned_amount':line.planned_amount,
                        'codif_amount':line.codif_amount,
                        'final': True,
                        'nivel': line.budget_post_id.nivel-1,
                        'level': line.budget_post_id.nivel-1,
                    }
 #               else:
 #                   res_line[line.budget_post_id.code]['planned_amount']+=line.planned_amount
                self.crear_padre(res_line[line.code], res_line[line.code],res_line)
            else:                                
                res_line[line.code]['planned_amount']+=line.planned_amount
                res_line[line.code]['codif_amount']+=line.codif_amount
#                res_line[line.budget_post_id.id+line.program_id.id]['planned_amount']+=line.planned_amount
        res_line['total']={'planned_amount': 0.00,
                           'codif_amount': 0.00,
                           'level':0,
                           'nivel':0,
                           'code':0,
                           'code_aux':0,
        }
        values=res_line.itervalues()
        for line_totales in values:
            if not 'level' in line_totales and line_totales['final']==True:
                res_line['total']['planned_amount']+=line_totales['planned_amount']
                res_line['total']['codif_amount']+=line_totales['codif_amount']        
        return res_line
    
    
    def export_report(self, cr, uid, ids, context=None):
        for this in self.browse(cr, uid, ids):
            writer = XLSWriter.XLSWriter()
            writer.append(['CEDULA CODIFICADO GASTOS'])
            writer.append(['DESDE',this.date_from,'HASTA',this.date_to])
            writer.append(['PARTIDA','DENOMINACION','CODIFICADO'])
            res=self._get_totales(cr, uid, ids)
            result_dic=res.values()
            import operator
            dic_ord=sorted(result_dic, key=operator.itemgetter('code_aux'))
            for values in dic_ord:
                if values.has_key('general_budget_name'):
                    writer.append([values['code'],values['general_budget_name'],values['codif_amount']])
            aux_funcion = self._get_total_funcion(cr, uid, ids, this.program_id,this.poa_id)
            writer.append(['','TOTAL FUNCION',aux_funcion])
            if this.program_id.sequence=='1.1':
                writer.append(['','TOTAL PRESUPUESTO',this.poa_id.total_presupuesto]) 
        writer.save("cedulaCodificadoGastos.xls")
        out = open("cedulaCodificadoGastos.xls","rb").read().encode("base64")
        self.write(cr, uid, ids, {'datas': out, 'datas_fname': 'cedulaCodificadoGastos.xls'})
        return True

    
    def print_report(self, cr, uid, ids, context=None):
        if context is None:
            context = {}     
        poa_obj = self.pool.get('budget.poa')
        reporte = self.browse(cr, uid, ids, context)[0]
        datas = {'ids': [reporte.id], 'model': 'cedula.codificado.gasto'}
        return {
            'type': 'ir.actions.report.xml',
            'report_name': 'cedula_codificado_gasto',
            'model': 'cedula.codificado.gasto',
            'datas': datas,
            'nodestroy': True,                        
            }
    
cedulaCodificadoGasto()

