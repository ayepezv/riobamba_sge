# -*- coding: utf-8 -*-
##############################################################################
#
# Mario Chogllo
# mariofchogllo@gmail.com
#
##############################################################################

import time
from osv import fields, osv
from time import strftime

class ejecutaIe(osv.TransientModel):

   _name ='ejecuta.ie'
   _columns = {
        'period_id': fields.many2one('hr.work.period.line', 'Periodo'),
       }
   

   def ejecuta_ie(self, cr, uid, ids, context):
      ie_obj = self.pool.get('hr.ie.head')
      if context is None:
         context = {}
      data = self.read(cr, uid, ids)[0]
      period_id = data['period_id'][0]
      head_all_ids = ie_obj.search(cr, uid, [('period_id','=',period_id),('state','=','pendiente')])
      if head_all_ids:
         for head_all_id in head_all_ids:
            ie_obj.a_borrador(cr, uid, [head_all_id], context)
      head_ids = ie_obj.search(cr, uid, [('period_id','=',period_id),('name.is_replanifica','=',False),('state','=','draft')])
      if head_ids:
         for head_id in head_ids:
            ie_obj.pendiente(cr, uid, [head_id], context)
      head_ids = ie_obj.search(cr, uid, [('period_id','=',period_id),('name.is_replanifica','=',True),('state','=','draft')],order='sequence desc')
      if head_ids:
         for head_id in head_ids:
            ie_obj.pendiente(cr, uid, [head_id], context)
      return {'type':'ir.actions.act_window_close' }

ejecutaIe()


