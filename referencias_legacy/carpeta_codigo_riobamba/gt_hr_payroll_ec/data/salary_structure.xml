<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
  <data noupdate="1">
    
    <!-- CATEGORIA DE REGLA SALARIAL PARA INGRESOS APORTABLES-->
    <record id="hr_payroll.GROSS" model="hr.salary.rule.category">
      <field name="name">Ingresos Aportables</field>
      <field name="code">APT</field>
    </record>
    
    <record id="hr_payroll.ALW" model="hr.salary.rule.category">
      <field name="name">Ingresos</field>
      <field name="code">ING</field>
    </record>
    
    <record id="hr_payroll.DED" model="hr.salary.rule.category">
      <field name="name">Egresos</field>
      <field name="code">EGR</field>
    </record>
    
    <record id="hr_payroll.NET" model="hr.salary.rule.category">
      <field name="name">Total</field>
      <field name="code">NET</field>
    </record>
    
    <!-- REGLA SALARIAL PARA LA REMUNERACION UNIFICADA -->
    
    <record id="hr_payroll.hr_rule_taxable" model="hr.salary.rule">
      <field name="name">Base de Aportacion</field>
      <field name="code">APT</field>
      <field name="category_id" ref="hr_payroll.GROSS"/>
      <field name="sequence" eval="199"/>
      <field name="amount_select">code</field>
      <field name="amount_python_compute">result = categories.BASIC + categories.APT</field>
    </record>
    
    <record id="hr_payroll.hr_rule_basic" model="hr.salary.rule">
      <field name="name">Remuneracion Unificada - Empleados</field>
      <field name="code">BASE</field>
      <field name="category_id" ref="hr_payroll.BASIC"/>
      <field name="sequence" eval="1"/>
      <field name="amount_select">code</field>
            <field name="amount_python_compute">dias = worked_days.WORK100.number_of_days

if worked_days.VAC:
    dias = dias + worked_days.VAC.number_of_days

if worked_days.ENF:
    dias = dias + worked_days.ENF.number_of_days

if worked_days.MAT:
    dias = dias + worked_days.MAT.number_of_days

result = (contract.wage/30)*(dias)</field>
        </record>
        
        <!--record id="hr_rule_basic_trabajadores" model="hr.salary.rule">
			<field name="name">Remuneracion Unificada - Trabajadores</field>
			<field name="code">BASET</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence" eval="1"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">dias = worked_days.WORK100.number_of_days

result = (contract.wage/30)*(dias)</field>
        </record-->
        
        <record id="hr_rule_vacaciones" model="hr.salary.rule">
			<field name="name">Vacaciones</field>
			<field name="code">BASE_VAC</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence" eval="5"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = worked_days.VAC</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">if worked_days.VAC:
    dias = worked_days.VAC.number_of_days

result = (contract.wage/30)*(dias)</field>
        </record>
        
        <record id="hr_rule_subsidio_enfermedad" model="hr.salary.rule">
			<field name="name">Subsidio de Enfermedad</field>
			<field name="code">BASE_ENF</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence" eval="6"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = worked_days.ENF</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">if worked_days.ENF:
    dias = worked_days.ENF.number_of_days

result = (contract.wage/30)*(dias)</field>
        </record>
        
        <record id="hr_rule_encargo_subrogacion" model="hr.salary.rule">
			<field name="name">Encargo y Subrogacion</field>
			<field name="code">BASE_ENCARGO</field>
            <field name="category_id" ref="hr_payroll.BASIC"/>
            <field name="sequence" eval="7"/>
            <field name="condition_select">python</field>
            <field name="condition_python">valor = 0
sueldo_encargo = 0
dias = 0

for encargo in contract.encargos_ids:
    #Para los casos que el encargo haya iniciado despues del inicio del mes de pago
    if date_time.greater_or_equal_than(encargo.date_start,payslip.date_from)==1:
        if encargo.date_stop==False:
            dias=(date_time.get_day(payslip.date_to)-date_time.get_day(encargo.date_start))
            sueldo_encargo=encargo.encargo_id.wage
        elif date_time.lower_or_equal_than(encargo.date_stop,payslip.date_to)==1:
            dias=(date_time.get_day(encargo.date_stop)-date_time.get_day(encargo.date_start))
            sueldo_encargo=encargo.encargo_id.wage
        else:
            dias=(date_time.get_day(payslip.date_to)-date_time.get_day(encargo.date_start))
            sueldo_encargo=encargo.encargo_id.wage
    #Para los casos que el encargo haya iniciado antes del inicio del mes de pago
    else:
        if encargo.date_stop==False:
            dias=29
            sueldo_encargo=encargo.encargo_id.wage
        elif date_time.lower_or_equal_than(encargo.date_stop,payslip.date_to)==1:
            dias=(date_time.get_day(encargo.date_stop)-date_time.get_day(payslip.date_from))
            sueldo_encargo=encargo.encargo_id.wage
        else:
            dias=29
            sueldo_encargo=encargo.encargo_id.wage

if dias>0:
    result = True
else:
    result = False</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">valor = 0
sueldo_encargo = 0
dias = 0

for encargo in contract.encargos_ids:
    #Para los casos que el encargo haya iniciado despues del inicio del mes de pago
    if date_time.greater_or_equal_than(encargo.date_start,payslip.date_from)==1:
        if encargo.date_stop==False:
            dias=(date_time.get_day(payslip.date_to)-date_time.get_day(encargo.date_start))
            detalle = worked_days.leaves_detail(encargo.date_start,payslip.date_to)
            sueldo_encargo=encargo.encargo_id.wage
        elif date_time.lower_or_equal_than(encargo.date_stop,payslip.date_to)==1:
            dias=(date_time.get_day(encargo.date_stop)-date_time.get_day(encargo.date_start))
            detalle = worked_days.leaves_detail(encargo.date_start,encargo.date_stop)
            sueldo_encargo=encargo.encargo_id.wage
        else:
            dias=(date_time.get_day(payslip.date_to)-date_time.get_day(encargo.date_start))
            detalle = worked_days.leaves_detail(encargo.date_start,payslip.date_to)
            sueldo_encargo=encargo.encargo_id.wage
    #Para los casos que el encargo haya iniciado antes del inicio del mes de pago
    else:
        if encargo.date_stop==False:
            dias=29
            detalle = worked_days.leaves_detail(payslip.date_from,payslip.date_to)
            sueldo_encargo=encargo.encargo_id.wage
        elif date_time.lower_or_equal_than(encargo.date_stop,payslip.date_to)==1:
            dias=(date_time.get_day(encargo.date_stop)-date_time.get_day(payslip.date_from))
            detalle = worked_days.leaves_detail(payslip.date_from,encargo.date_stop)
            sueldo_encargo=encargo.encargo_id.wage
        else:
            dias=29
            detalle = worked_days.leaves_detail(payslip.date_from,payslip.date_to)
            sueldo_encargo=encargo.encargo_id.wage

if dias>0 and 30>dias:
    dias=dias+1

dias = detalle['WORK100']['number_of_days']

if (sueldo_encargo>contract.wage):
    valor=(dias*sueldo_encargo/30)-(dias*contract.wage/30)

result=valor</field>
        </record>
        
        <!-- REGLA SALARIAL PARA INGRESOS APORTABLES -->
        <!--record id="regla_ingresos_aportables" model="hr.salary.rule">
			<field name="name">Ingresos Aportables</field>
			<field name="code">APT</field>
            <field name="category_id" ref="hr_payroll.GROSS"/>
            <field name="sequence" eval="11"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.APT</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">valor = 0

if inputs.APT:
    valor = inputs.APT.amount

result = valor</field>
        </record-->
        
        <!-- REGLA SALARIAL PARA INGRESOS -->
        <!--record id="regla_ingresos" model="hr.salary.rule">
			<field name="name">Ingresos</field>
			<field name="code">ING</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="21"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.ING</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">valor = 0

if inputs.ING:
    valor = inputs.ING.amount

result = valor</field>
        </record-->
        
        <!-- REGLA SALARIAL PARA EGRESOS -->
        <!--record id="regla_egresos" model="hr.salary.rule">
			<field name="name">Egresos</field>
			<field name="code">EGR</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="31"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.EGR</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">valor = 0

if inputs.EGR:
    valor = inputs.EGR.amount

result = valor</field>
        </record-->
        
        <!-- REGLA SALARIAL PARA SUBSIDIOS -->
        <record id="regla_subsidio_familiar" model="hr.salary.rule">
			<field name="name">Subsidio Familiar</field>
			<field name="code">SUB_FAMILIAR</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="102"/>
            <field name="condition_select">python</field>
            <field name="condition_python">total = 0
for familiar in employee.family_item_ids:
    if familiar.carga_justificada==True:
        total = total + 4
if total>0:
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">total = 0
for familiar in employee.family_item_ids:
    if familiar.carga_justificada==True:
        total = total + 4
result = total</field>
        </record>
        
        <record id="regla_subsidio_antiguedad" model="hr.salary.rule">
			<field name="name">Subsidio Antiguedad</field>
			<field name="code">SUB_ANTIGUEDAD</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="103"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">total = 12
extra = 0

if 2010 >= date_time.get_year(contract.date_start):
    extra = 318*0.03*(date_time.get_year(payslip.date_to)-2010)

result = total + extra</field>
        </record>
        
        <!-- REGLA SALARIAL PARA LA PENSION ALIMENTOS y FUNCION JUDICIAL-->
        <record id="regla_pension_alimentos" model="hr.salary.rule">
			<field name="name">Pension de Alimentos</field>
			<field name="code">PENSION_ALIMENTOS</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="210"/>
            <field name="condition_select">python</field>
            <field name="condition_python">total = 0
for familiar in employee.family_item_ids:
    if familiar.recibe_pension=='pension_alimentos':
        total = total + familiar.valor_pension
if total>0:
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">total = 0
for familiar in employee.family_item_ids:
    if familiar.recibe_pension=='pension_alimentos':
        total = total + familiar.valor_pension
result = total</field>
        </record>
        
        <record id="regla_funcion_judiciak" model="hr.salary.rule">
			<field name="name">Funcion Judicial</field>
			<field name="code">FUNCION_JUDICIAL</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="210"/>
            <field name="condition_select">python</field>
            <field name="condition_python">total = 0
for familiar in employee.family_item_ids:
    if familiar.recibe_pension=='funcion_judicial':
        total = total + familiar.valor_pension
if total>0:
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">total = 0
for familiar in employee.family_item_ids:
    if familiar.recibe_pension=='funcion_judicial':
        total = total + familiar.valor_pension
result = total</field>
        </record>
        
        
        <!-- REGLA SALARIAL PARA EL APORTE PERSONAL DEL IESS -->
        <record id="regla_aporte_personal_iess" model="hr.salary.rule">
			<field name="name">Aporte Personal IESS - Trabajadores</field>
			<field name="code">IESS_PERSONALT</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="201"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = (categories.BASIC + categories.APT)*0.0935</field>
        </record>
        
        <record id="regla_aporte_personal_iess_empleados" model="hr.salary.rule">
			<field name="name">Aporte Personal IESS - Empleados</field>
			<field name="code">IESS_PERSONAL</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="201"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = (categories.BASIC + categories.APT)*0.1135</field>
        </record>
        
        <record id="regla_extension_cobertura_iess" model="hr.salary.rule">
			<field name="name">Extension de cobertura del IESS</field>
			<field name="code">IESS_EXTENSION</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="202"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.extension_iess</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = (contract.wage + categories.APT)*0.0341</field>
        </record>

        <record id="regla_iess_conyugue" model="hr.salary.rule">
	  <field name="name">Aporte Personal IESS Conyugue</field>
	  <field name="code">IESS_CONYUGUE</field>
          <field name="category_id" ref="hr_payroll.DED"/>
          <field name="sequence" eval="202"/>
          <field name="condition_select">python</field>
          <field name="condition_python">if inputs.Quirografario
    result=True
else:
    result=False</field>
          <field name="amount_select">code</field>
          <field name="amount_python_compute">result = inputs.IESS_CONYUGUE.amount</field>
        </record>
        
        <!-- REGLA SALARIAL PARA EL IMPUESTO A LA RENTA -->
        <record id="regla_impuesto_renta" model="hr.salary.rule">
			<field name="name">Impuesto a la Renta</field>
			<field name="code">IMP_RENTA</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="203"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">valor = sri_ec.impuesto_renta(contract,payslip.period_id,categories.BASIC,categories.APT,0.0935)

result = valor</field>
        </record>
        
        <!-- REGLA SALARIAL PARA EL FONDO DE RESERVA -->
        <record id="regla_fondo_reserva" model="hr.salary.rule">
			<field name="name">Fondos de Reserva</field>
			<field name="code">FRESERVA</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="101"/>
            <field name="condition_select">python</field>
            <field name="condition_python">#dividimos la fecha del contrato en año, mes y dia
fecha_c = str(contract.date_start)
anio_c = fecha_c[:4]
mes_c = fecha_c[5:7]
dia_c = fecha_c[8:10]

#obtenemos el valor del año del contrato
val_anio_c = 1950
validar = 0
while (validar == 0):
    val_anio_c = val_anio_c + 1
    if str(val_anio_c) == anio_c:
        validar = 1

#obtenemos el valor del mes del contrato
val_mes_c = 0
validar = 0
while (validar == 0):
    val_mes_c = val_mes_c + 1
    if (str(val_mes_c) == mes_c) or ('0'+str(val_mes_c) == mes_c):
        validar = 1

#obtenemos el valor del dia del contrato
val_dia_c = 0
validar = 0
while (validar == 0):
    val_dia_c = val_dia_c + 1
    if (str(val_dia_c) == dia_c) or ('0'+str(val_dia_c) == dia_c):
        validar = 1

#dividimos la fecha de fin del rol de pagos en año, mes y dia
fecha_p = str(payslip.date_to)
anio_p = fecha_p[:4]
mes_p = fecha_p[5:7]
dia_p = fecha_p[8:10]

#obtenemos el valor del año del rol
val_anio_p = 1950
validar = 0
while (validar == 0):
    val_anio_p = val_anio_p + 1
    if str(val_anio_p) == anio_p:
        validar = 1

#obtenemos el valor del mes del rol
val_mes_p = 0
validar = 0
while (validar == 0):
    val_mes_p = val_mes_p + 1
    if (str(val_mes_p) == mes_p) or ('0'+str(val_mes_p) == mes_p):
        validar = 1

#obtenemos el valor del ultimo dia del rol
val_dia_p = 0
validar = 0
while (validar == 0):
    val_dia_p = val_dia_p + 1
    if (str(val_dia_p) == dia_p) or ('0'+str(val_dia_p) == dia_p):
        validar = 1

#calculamos el total de dias de diferencia entre el contrato y el rol
dias = ((val_anio_p*365)+(val_mes_p*30)+val_dia_p) - ((val_anio_c*365)+(val_mes_c*30)+val_dia_c)
dias = dias + contract.dias_fr

#si los dias son mayores a 365 o 1 año, se puede proceder a calcular el valor
result = (dias>365) and (contract.fondo_reserva==True)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">#dividimos la fecha del contrato en año, mes y dia
fecha_c = str(contract.date_start)
anio_c = fecha_c[:4]
mes_c = fecha_c[5:7]
dia_c = fecha_c[8:10]

#obtenemos el valor del año del contrato
val_anio_c = 1950
validar = 0
while (validar == 0):
    val_anio_c = val_anio_c + 1
    if str(val_anio_c) == anio_c:
        validar = 1

#obtenemos el valor del mes del contrato
val_mes_c = 0
validar = 0
while (validar == 0):
    val_mes_c = val_mes_c + 1
    if (str(val_mes_c) == mes_c) or ('0'+str(val_mes_c) == mes_c):
        validar = 1

#obtenemos el valor del dia del contrato
val_dia_c = 0
validar = 0
while (validar == 0):
    val_dia_c = val_dia_c + 1
    if (str(val_dia_c) == dia_c) or ('0'+str(val_dia_c) == dia_c):
        validar = 1

#dividimos la fecha de fin del rol de pagos en año, mes y dia
fecha_p = str(payslip.date_to)
anio_p = fecha_p[:4]
mes_p = fecha_p[5:7]
dia_p = fecha_p[8:10]

#obtenemos el valor del año del rol
val_anio_p = 1950
validar = 0
while (validar == 0):
    val_anio_p = val_anio_p + 1
    if str(val_anio_p) == anio_p:
        validar = 1

#obtenemos el valor del mes del rol
val_mes_p = 0
validar = 0
while (validar == 0):
    val_mes_p = val_mes_p + 1
    if (str(val_mes_p) == mes_p) or ('0'+str(val_mes_p) == mes_p):
        validar = 1

#obtenemos el valor del ultimo dia del rol
val_dia_p = 0
validar = 0
while (validar == 0):
    val_dia_p = val_dia_p + 1
    if (str(val_dia_p) == dia_p) or ('0'+str(val_dia_p) == dia_p):
        validar = 1

#calculamos el total de dias de diferencia entre el contrato y el rol
dias = ((val_anio_p*365)+(val_mes_p*30)+val_dia_p) - ((val_anio_c*365)+(val_mes_c*30)+val_dia_c)
dias = dias + contract.dias_fr
valor = 0

#si son menos de 30 dias, luego de pasado 1 año de trabajo, se calcula el proporcional a los dias correspondientes, caso contrario se coloca el valor completo
if (dias-365)>=0:
    valor = ((categories.BASIC + categories.APT) * 0.0833)
else:
    if val_mes_p==1 or val_mes_p==3 or val_mes_p==5 or val_mes_p==7 or val_mes_p==8 or val_mes_p==10 or val_mes_p==12:
        dias = dias + 1
    valor = (((categories.BASIC + categories.APT)*0.0833)/30.0)*(dias-365.0)

result = valor</field>
        </record>
        
        <!-- REGLA SALARIAL PARA ENVIAR FONDOS DE RESERVA AL IESS -->
        <record id="regla_freserva_iess" model="hr.salary.rule">
			<field name="name">Extra Rol - Fondos de Reserva a IESS</field>
			<field name="code">EXTRA_FRESERVA_IESS</field>
            <field name="category_id" ref="hr_payroll.COMP"/>
            <field name="sequence" eval="510"/>
            <field name="condition_select">python</field>
            <field name="condition_python">#dividimos la fecha del contrato en año, mes y dia
fecha_c = str(contract.date_start)
anio_c = fecha_c[:4]
mes_c = fecha_c[5:7]
dia_c = fecha_c[8:10]

#obtenemos el valor del año del contrato
val_anio_c = 1950
validar = 0
while (validar == 0):
    val_anio_c = val_anio_c + 1
    if str(val_anio_c) == anio_c:
        validar = 1

#obtenemos el valor del mes del contrato
val_mes_c = 0
validar = 0
while (validar == 0):
    val_mes_c = val_mes_c + 1
    if (str(val_mes_c) == mes_c) or ('0'+str(val_mes_c) == mes_c):
        validar = 1

#obtenemos el valor del dia del contrato
val_dia_c = 0
validar = 0
while (validar == 0):
    val_dia_c = val_dia_c + 1
    if (str(val_dia_c) == dia_c) or ('0'+str(val_dia_c) == dia_c):
        validar = 1

#dividimos la fecha de fin del rol de pagos en año, mes y dia
fecha_p = str(payslip.date_to)
anio_p = fecha_p[:4]
mes_p = fecha_p[5:7]
dia_p = fecha_p[8:10]

#obtenemos el valor del año del rol
val_anio_p = 1950
validar = 0
while (validar == 0):
    val_anio_p = val_anio_p + 1
    if str(val_anio_p) == anio_p:
        validar = 1

#obtenemos el valor del mes del rol
val_mes_p = 0
validar = 0
while (validar == 0):
    val_mes_p = val_mes_p + 1
    if (str(val_mes_p) == mes_p) or ('0'+str(val_mes_p) == mes_p):
        validar = 1

#obtenemos el valor del ultimo dia del rol
val_dia_p = 0
validar = 0
while (validar == 0):
    val_dia_p = val_dia_p + 1
    if (str(val_dia_p) == dia_p) or ('0'+str(val_dia_p) == dia_p):
        validar = 1

#calculamos el total de dias de diferencia entre el contrato y el rol
dias = ((val_anio_p*365)+(val_mes_p*30)+val_dia_p) - ((val_anio_c*365)+(val_mes_c*30)+val_dia_c)
dias = dias + contract.dias_fr

#si los dias son mayores a 365 o 1 año, se puede proceder a calcular el valor
result = (dias>365) and (contract.fondo_reserva==False)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">#dividimos la fecha del contrato en año, mes y dia
fecha_c = str(contract.date_start)
anio_c = fecha_c[:4]
mes_c = fecha_c[5:7]
dia_c = fecha_c[8:10]

#obtenemos el valor del año del contrato
val_anio_c = 1950
validar = 0
while (validar == 0):
    val_anio_c = val_anio_c + 1
    if str(val_anio_c) == anio_c:
        validar = 1

#obtenemos el valor del mes del contrato
val_mes_c = 0
validar = 0
while (validar == 0):
    val_mes_c = val_mes_c + 1
    if (str(val_mes_c) == mes_c) or ('0'+str(val_mes_c) == mes_c):
        validar = 1

#obtenemos el valor del dia del contrato
val_dia_c = 0
validar = 0
while (validar == 0):
    val_dia_c = val_dia_c + 1
    if (str(val_dia_c) == dia_c) or ('0'+str(val_dia_c) == dia_c):
        validar = 1

#dividimos la fecha de fin del rol de pagos en año, mes y dia
fecha_p = str(payslip.date_to)
anio_p = fecha_p[:4]
mes_p = fecha_p[5:7]
dia_p = fecha_p[8:10]

#obtenemos el valor del año del rol
val_anio_p = 1950
validar = 0
while (validar == 0):
    val_anio_p = val_anio_p + 1
    if str(val_anio_p) == anio_p:
        validar = 1

#obtenemos el valor del mes del rol
val_mes_p = 0
validar = 0
while (validar == 0):
    val_mes_p = val_mes_p + 1
    if (str(val_mes_p) == mes_p) or ('0'+str(val_mes_p) == mes_p):
        validar = 1

#obtenemos el valor del ultimo dia del rol
val_dia_p = 0
validar = 0
while (validar == 0):
    val_dia_p = val_dia_p + 1
    if (str(val_dia_p) == dia_p) or ('0'+str(val_dia_p) == dia_p):
        validar = 1

#calculamos el total de dias de diferencia entre el contrato y el rol
dias = ((val_anio_p*365)+(val_mes_p*30)+val_dia_p) - ((val_anio_c*365)+(val_mes_c*30)+val_dia_c)
dias = dias + contract.dias_fr

valor = 0

#si son menos de 30 dias, luego de pasado 1 año de trabajo, se calcula el proporcional a los dias correspondientes, caso contrario se coloca el valor completo
if (dias-365)>=0:
    valor = ((categories.BASIC + categories.APT) * 0.0833)
result = valor</field>
        </record>
        
        <record id="hr_payroll.hr_rule_net_ing" model="hr.salary.rule">
            <field name="name">TOTAL INGRESOS</field>
            <field name="sequence" eval="997"/>
            <field name="code">NETI</field>
            <field name="category_id" ref="hr_payroll.NET"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.BASIC + categories.ING + categories.APT</field>
        </record>

        <record id="hr_payroll.hr_rule_net_egr" model="hr.salary.rule">
            <field name="name">TOTAL EGRESOS</field>
            <field name="sequence" eval="998"/>
            <field name="code">NETE</field>
            <field name="category_id" ref="hr_payroll.NET"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.EGR</field>
        </record>

        <record id="hr_payroll.hr_rule_net" model="hr.salary.rule">
            <field name="name">TOTAL</field>
            <field name="sequence" eval="999"/>
            <field name="code">NET</field>
            <field name="category_id" ref="hr_payroll.NET"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.BASIC + categories.ING + categories.APT - categories.EGR</field>
        </record>
		
		<!-- Estructura Salarial Base -->
		<record id="hr_payroll.structure_base" model="hr.payroll.structure">
			<field name="name">Estructura Base</field>
			<field name="code">BASE</field>
			<field name="parent_id"></field>
			<field eval="[(6, 0, [ref('hr_payroll.hr_rule_net')])]" name="rule_ids"/>
			<!--field eval="[(6, 0, [ref('hr_payroll.hr_rule_basic'), ref('regla_ingresos_aportables'), ref('regla_ingresos'), ref('regla_egresos'), ref('regla_aporte_personal_iess'), ref('regla_impuesto_renta'), ref('regla_fondo_reserva'), ref('regla_freserva_iess'), ref('provision_decimo13'), ref('provision_decimo14'), ref('provision_vacaciones'), ref('provision_iess_patronal'), ref('provision_iece'), ref('provision_secap'), ref('regla_provisiones'), ref('hr_payroll.hr_rule_net')])]" name="rule_ids"/-->
		</record>
		
		<record id="regla_quirografario" model="hr.salary.rule">
			<field name="name">Prestamo Quirografario</field>
			<field name="code">Quirografario</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="205"/>
			<field name="condition_select">python</field>
			<field name="condition_python">if inputs.Quirografario
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
			<field name="amount_python_compute">result= inputs.Quirografario.amount</field>
        </record>

		<record id="regla_hipotecario" model="hr.salary.rule">
			<field name="name">Prestamo Hipotecario</field>
			<field name="code">Hipotecario</field>
            <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="206"/>
			<field name="condition_select">python</field>
			<field name="condition_python">if inputs.Hipotecario
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
			<field name="amount_python_compute">result= inputs.Hipotecario.amount</field>
        </record>

		<record id="regla_otros_desc" model="hr.salary.rule">
		  <field name="name">Otros Descuentos</field>
		  <field name="code">OtrosDescuentos</field>
          <field name="category_id" ref="hr_payroll.DED"/>
            <field name="sequence" eval="221"/>
			<field name="condition_select">python</field>
			<field name="condition_python">if inputs.OtrosDescuentos
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
			<field name="amount_python_compute">result= inputs.OtrosDescuentos.amount</field>
        </record>

<!--regla decimos-->
		<record id="regla_decimo3" model="hr.salary.rule">
			<field name="name">DEC. III</field>
			<field name="code">dec3</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="101"/>
			<field name="condition_select">python</field>
			<field name="condition_python">if inputs.dec3
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
			<field name="amount_python_compute">result= inputs.dec3.amount</field>
        </record>

		<record id="regla_decimo4" model="hr.salary.rule">
			<field name="name">DEC. IV</field>
			<field name="code">dec4</field>
            <field name="category_id" ref="hr_payroll.ALW"/>
            <field name="sequence" eval="101"/>
			<field name="condition_select">python</field>
			<field name="condition_python">if inputs.dec4
    result=True
else:
    result=False</field>
            <field name="amount_select">code</field>
			<field name="amount_python_compute">result= inputs.dec4.amount</field>
        </record>

	</data>
</openerp>
