<?xml version="1.0"?>
<openerp>
    <data>

      <record id="view_requisition_cancel_form" model="ir.ui.view">
      <field name="name">requisition.cancel.form</field>
      <field name="model">purchase.requisition.cancel</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
	<form string="Cancelacion de solicitud de compra">
          <field name="name" readonly="1"/>
          <field name="user_id" readonly="1"/>
	  <field name="requisition_id"/>
	  <newline/>
	  <field name="notes1" colspan="2"/>
	  <field name="notes2" colspan="2" groups="purchase.group_purchase_manager" attrs="{'readonly': [('state', 'not in',('pendiente'))],
									       'invisible': [('state', '=','draft')]}"/>
          <group colspan="8" col="6">
            <field name="state" widget="statusbar" statusbar_visible="draft,request,done"/>
	    <button icon="gtk-cancel" type="object" name="draft_solicitud" states="pendiente"  string="A borrador" confirm="Seguro de pasar a borrador ?"/>
            <!--button icon="gtk-cancel" type="object" name="cancelar_solicitud" states="draft,pendiente"  string="Anular" confirm="Seguro de Anular documento ?"/-->
            <button icon="gtk-execute" type="object" name="pendiente_solicitud" states="draft" string="Solicitar" confirm="Seguro de solicitar la cancelacion ?"/>
            <button icon="gtk-go-forward" name="aprobar_solicitud" states="pendiente" string="Aprobar" type="object" confirm="Seguro aprobar la solicitud ?"/>
            <button icon="gtk-go-forward" name="rechazar_solicitud" states="pendiente" string="Rechazar" type="object" confirm="Seguro de rechazar la solicitud ?"/>
          </group>                    	  
	    </form>
      </field>
    </record>

    <record id="view_requisition_cancel_tree" model="ir.ui.view">
      <field name="name">requisition.cancel.tree</field>
      <field name="model">purchase.requisition.cancel</field>
      <field name="type">tree</field>
      <field name="arch" type="xml">
        <tree string="Solicitudes de cancelacion" colors="black:state=='draft'; blue:state in ('pendiente'); green:state=='aproved'; red:state=='rechazada'">
          <field name="name"/>
          <field name="user_id"/>
	  <field name="requisition_id"/>
	  <field name="state"/>
        </tree>
      </field>
    </record>


    <record id="view_requisition_cancel_filter" model="ir.ui.view">
      <field name="name">requisition.cancel.select</field>
      <field name="model">purchase.requisition.cancel</field>
      <field name="type">search</field>
      <field name="arch" type="xml">
        <search string="Solicitudes de anulacion">
          <group>
	    <field name="name"/>
            <field name="user_id"/>
	    <field name="asunto"/>
	    <field name="justificativo"/>
            <field name="requisition_id"/>
            <field name="state"/>
          </group>
          <newline/>
          <group expand="1" string="Agrupar por...">
            <filter string="Usuario" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'user_id'}"/>
            <filter string="Estado" icon="terp-stage" context="{'group_by': 'state'}"/>
          </group>
        </search>
      </field>
    </record>    

  <record id="action_requisition_cancel" model="ir.actions.act_window">
    <field name="name">Solicitudes de cancelacion</field>
    <field name="res_model">purchase.requisition.cancel</field>
    <field name="view_type">form</field>
    <field name="view_mode">tree,form</field>
  </record>

<menuitem id="menu_purchase_requisition_document" parent="gt_document_manager.menu_document_manager" 
		  name="Solicitudes de Compra" sequence="4" groups="group_purchase_basic,gt_document_manager.group_doc_user"/>

  <menuitem id="menu_purchase_requisition_cancel"
            action="action_requisition_cancel" parent="menu_purchase_requisition_document" sequence="10"/>
  
  <record id="product_product_req_view_modified" model="ir.ui.view">
    <field name="name">Producto Modificado Req</field>
    <field name="model">product.product</field>
    <field name="type">form</field>
    <field name="inherit_id" ref="purchase_requisition.product_normal_form_view_inherit"/>
    <field name="arch" type="xml">
      <field name="purchase_requisition" position="replace"/>
    </field>
  </record>

      <record model="ir.ui.view" id="purchase_requisition.view_purchase_requisition_tree">
        <field name="name">purchase.requisition.tree</field>
        <field name="type">tree</field>
        <field name="model">purchase.requisition</field>
        <field name="arch" type="xml">
          <tree colors="black:state == 'draft';blue:state in ('aproved','recomended','select','in_progress');
			grey:state in ('cancel','group');
						green:state =='done';" string="Solicitudes de compra">
            <field name="name" string="Código"/>
            <field name="user_id" string="Creado por"/>
            <field name="asunto"/>
	    <field name="justificativo"/>
	    <!--field name="usr_solicitant_id"/-->
            <field name="date_start"/>
	    <field name="revert"/>
            <field name="state"/>
          </tree>
        </field>
      </record>
	  
	  <!--record model="ir.rule" id="purchase_requisition_rule">
		<field name="name">Solicitudes compra por area</field>
		<field name="model_id" ref="model_purchase_requisition"/>
		<field name="global" eval="True"/>
		<field name="domain_force">[('department_id','child_of',user.context_department_id.id)]</field>
		<field name="groups" eval="[(4,ref('gt_document_manager.group_doc_leader'))]"/>
	  </record>

    <record model="ir.rule" id="purchase_requisition_purchase_user_all_rule">
        <field name="name">Adquisiones: Todos las solicitudes</field>
        <field name="model_id" ref="model_purchase_requisition"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4,ref('purchase.group_purchase_manager'))]"/>
    </record-->

<record id="view_purchase_requisition_filter_3" model="ir.ui.view">
  <field name="name">purchase.requisition.list.select.2</field>
  <field name="model">purchase.requisition</field>
  <field name="type">search</field>
  <field name="arch" type="xml">
    <search string="Search Purchase Requisition">
      <group>
        <field name="name"/>
        <field name="asunto"/>
        <field name="justificativo"/>
        <!--field name="user_id" readonly="1"/-->
       </group>
      <newline/>
      <group expand="1" string="Agrupar por...">
         <filter string="Estado" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
         <separator orientation="vertical"/>
        <filter string="Fecha Inicio" icon="terp-go-month" domain="[]" context="{'group_by':'date_start'}"/>
        <filter string="Fecha Hasta" icon="terp-go-month" domain="[]" context="{'group_by':'date_end'}"/>
      </group>
    </search>
  </field>
</record>

<!-- TODAS -->

<record id="view_purchase_requisition_filter_2" model="ir.ui.view">
  <field name="name">purchase.requisition.list.select.2</field>
  <field name="model">purchase.requisition</field>
  <field name="type">search</field>
  <field name="arch" type="xml">
    <search string="Buscar Solicitudes Compra">
	  <!--group>
		<filter icon="terp-document-new" name="anuled_me" string="Anuladas" domain="[('state','=','cancel'),('anulant_id','=',uid)]"  help="Solicitudes de compra anuladas por mi"/>
	  </group-->
      <group>
        <field name="name"/>
        <field name="user_id" invisible="1"/>
	<field name="asunto"/>
        <field name="justificativo"/>
	<field name="usr_solicitant_id"/>
	<field name="state"/>
	<field name="revert"/>
      </group>
      <newline/>
      <group expand="1" string="Agrupar por...">
        <filter string="Responsable" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}"/>
        <separator orientation="vertical"/>
        <filter string="Origen" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'origin'}"/>
        <separator orientation="vertical"/>
        <filter string="Fecha desde" icon="terp-go-month" domain="[]" context="{'group_by':'date_start'}"/>
        <filter string="Fecha hasta" icon="terp-go-month" domain="[]" context="{'group_by':'date_end'}"/>
      </group>
    </search>
  </field>
</record>

<record id="view_purchase_requisition_filter_3" model="ir.ui.view">
  <field name="name">purchase.requisition.list.select.2</field>
  <field name="model">purchase.requisition</field>
  <field name="type">search</field>
  <field name="arch" type="xml">
    <search string="Buscar Solicitudes Compra">
	  <group>
		<filter icon="terp-document-new" name="anuled_me" string="Anuladas" domain="[('state','=','cancel'),('anulant_id','=',uid)]"  help="Solicitudes de compra anuladas por mi"/>
	  </group>
      <group>
        <field name="name"/>
        <field name="user_id"/>
		<field name="usr_solicitant_id" invisible="1"/>
      </group>
      <newline/>
      <group expand="1" string="Agrupar por...">
        <filter string="Responsable" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}"/>
        <separator orientation="vertical"/>
        <filter string="Origen" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'origin'}"/>
        <separator orientation="vertical"/>
        <filter string="Fecha desde" icon="terp-go-month" domain="[]" context="{'group_by':'date_start'}"/>
        <filter string="Fecha hasta" icon="terp-go-month" domain="[]" context="{'group_by':'date_end'}"/>
      </group>
    </search>
  </field>
</record>

<record model="ir.actions.act_window" id="action_purchase_requisition_normal">
  <field name="name">Solicitudes de compra</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="purchase_requisition.menu_purchase_requisition_pro_mgt"
   sequence="0"
   parent="purchase.menu_procurement_management"
   action="action_purchase_requisition_normal"/>

<record model="ir.ui.view" id="purchase_req_inherit">
  <field name="name">purchase.req.form.inherit</field>
  <field name="type">form</field>
  <field name="model">purchase.requisition</field>
  <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_form"/>
  <field name="arch" type="xml">
    <field name="user_id" position="replace"></field>
    <field name="date_start" position="replace"></field>
    <field name="date_end" position="replace"></field>
    <field name="origin" position="replace"></field>
    <field name="warehouse_id" position="replace"></field>
    <field name="name" position="replace">
      <field name="user_id" readonly="1" string="Creado por" colspan="4"/>
      <field name="date_start"/>
      <field name="name" readonly="1" string="Código"/>
      <!--field name="presp_ref" string="Doc. Presupuestario"
	  domain="[('state','in',('certified','commited')),('is_lock','=',False)]"
	  attrs="{'readonly': [('state', 'not in',('draft','select'))],'required': [('state', '=','select')]}" 
	  colspan="4" /-->
      <field name="presp_ref" string="Doc. Presupuestario"
	     domain="[('state','in',('certified','commited')),('is_lock','=',False)]"
	     colspan="4" readonly="1"/>
      <field name="solicitant_id" on_change="onchange_solicitant_sol(solicitant_id)"
	     attrs="{'readonly': [('state', 'not in',('draft'))]}" colspan="2"/>
      <field name="department_id" widget="selection" colspan="4"/>
      <field name="contract_object" on_change="onchange_code(contract_object)" 
	     attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
      <!--field name="objeto_id_id" attrs="{'readonly': [('state', 'not in',('draft'))]}"/-->
      <field name="referencia_bodega" attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
      <field name="total_compra"/>
      <field name="str_tipos" invisible="1"/>
    </field>
    <!-- vista antigua
	 <field name="name" position="replace">
	 <field name="name" readonly="1" string="Código"/>
	 <field name="tabla_id" readonly="1"/>
	 <field name="sgd_id" domain="[('state','!=','draft')]" 
	 attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	 <field name="presp_ref" required="1" domain="[('state','=','certified'),('is_lock','=',False)]"
	 attrs="{'readonly': [('state', 'not in',('draft'))]}" colspan="4"/>
	 </field>
	 <field name="date_start" position="replace">
	 <field name="date_start" readonly="1"/>
	 </field>
	 <field name="company_id" position="replace"></field>
	 <field name="user_id" position="replace">
	 <field name="user_id" readonly="1" string="Creado por"/>
	 <field name="str_tipos" invisible="1"/>
	 <field name="solicitant_id" domain="[('department_id','=',department_id)]" 
	 attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	 </field>
	 <field name="origin" position="replace"></field>
	 <field name="date_end" position="replace"></field>
	 <field name="warehouse_id" position="replace">
	 <field name="department_id" widget="selection" readonly="1"/>
	 <field name="unidad_id" domain="[('usage','=','internal')]" invisible="1"/>
	 <field name="referencia_bodega" attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	 <field name="contract_object" on_change="onchange_code(contract_object)" 
	 attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	 <field name="total_compra"/>
	 <field name="observation" colspan="4" attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	 </field>
    -->
    <field name="exclusive" position="replace">
    </field>
    <xpath expr="/form/notebook/page[@string='Notes']" position="replace">
      <!--page string="Observaciones">
          <field name="description" colspan="4" nolabel="1" attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	  </page-->
    </xpath>
    <xpath expr="/form/notebook/page[@string='Products']/field[@name='line_ids']" position="replace">
      <field name="line_ids" colspan="4" nolabel="1" attrs="{'readonly': [('state', 'not in',('draft','start','aproved'))]}">
	<tree string="Products" editable="bottom">
	  <field name="product_id"
		 on_change="onchange_product_id(product_id,product_uom_id)" required="1"
		 attrs="{'readonly': [('state', 'not in',('draft','start'))]}"/>
	  <!--field name="product_id" domain="[('type','in',parent.str_tipos.split())]"
		 on_change="onchange_product_id(product_id,product_uom_id)" required="1"
		 attrs="{'readonly': [('state', 'not in',('draft','start'))]}"/-->
	  <!--field name="code" readonly="1"/-->
          <field name="product_qty" required="1" attrs="{'readonly': [('state', 'not in',('draft','start','aproved'))]}"/>
	  <!--field name="qty_aproved"/>
              <field name="product_uom_id"/-->
	  <field name="desc" attrs="{'readonly': [('state', 'not in',('draft','start'))]}"/>
	  <field name="state" invisible="1"/>
	</tree>
      </field>
    </xpath>
	<xpath expr="/form/notebook/page/group[@col='8']" position="replace">
	</xpath>
	<xpath expr="/form/notebook" position="after">
	  <group col="23" colspan="4">
		<field name="state" select="1" readonly ="1" widget="statusbar" statusbar_visible="draft,in_progress,done,aproved,recomended,select,comprometed" statusbar_colors='{"in_progress":"blue"}' help="La solicitud de compra se genera en estado Nueva, el director de la unidad requiriente aprueba la solicitud, el area de compras solicita cotizaciones a los proveedores y recomienda le mejor, el director administrativo elije la mejor oferta, presupuestos revisa la solicitud de compra, realiza el compromiso presupuestario y finalmente el area de compras genera la orden de compra."/>
		<button name="%(action_cancel_process)d" states="draft" groups="gt_government_procedure.group_purchase_basic" string="Anular Solicitud" type="action" icon="gtk-cancel"/>
		<button name="%(action_cancel_process)d" states="in_progress" groups="gt_document_manager.group_doc_leader" string="Anular Solicitud" type="action" icon="gtk-cancel"/>
        <button name="%(action_return_state)d" states="in_progress" string="Regresar" type="action" icon="gtk-go-back" groups="gt_document_manager.group_doc_user"/>
        <button name="%(action_return_state)d" states="in_progress" string="Regresar" type="action" icon="gtk-go-back" groups="gt_document_manager.group_doc_leader"/>
        <button name="%(action_return_state)d" states="aproved,select" string="Regresar" type="action" icon="gtk-go-back" groups="purchase.group_purchase_user"/>
        <button name="%(action_return_state)d" states="recomended" string="Regresar" type="action" icon="gtk-go-back" groups="purchase.group_purchase_user"/>
        <!--button name="%(action_return_state)d" states="select" string="Regresar" type="action" icon="gtk-go-back" groups="gt_government_procedure.group_administrative"/-->
		<button name="%(action_return_state)d" states="comprometed" string="Regresar" type="action" icon="gtk-go-back" groups="gt_government_procedure.group_administrative"/>
        <button name="%(action_return_start)d" states="comprometed,cancel,done" string="Regresar Borrador" type="action" icon="gtk-go-back" groups="gt_government_procedure.group_administrative"/>
		<button name="tender_in_progress" groups="gt_government_procedure.group_purchase_solicitant,gt_document_manager.group_doc_user" states="draft" string="Comenzar Proceso" type="object" icon="gtk-go-forward" confirm="Confirmar desea comenzar el proceso?"/>
		<button name="tender_aprovedd" groups="gt_document_manager.group_doc_leader" states="in_progress" string="Aprobado" type="object" icon="gtk-apply" confirm="Confirmar desea aprobar?"/>
		<!--button name="%(action_cancel_process)d" groups="gt_document_manager.group_doc_leader" states="in_progress" string="Negar" type="object" icon="gtk-cancel" confirm="Confirmar desea anular?"/-->
		<button name="tender_recomended" groups="purchase.group_purchase_user" states="aproved" 
				string="Recomendar" type="object" icon="terp-check" confirm="Esta seguro que desea recomendar"/>
		<button name="%(action_finaliza_process)d" groups="purchase.group_purchase_user" states="aproved" 
				string="Finalizar" type="action" icon="terp-check"/>
		<button name="tender_select" states="recomended" string="Autorizar" type="object" icon="terp-check" confirm="Confirmar desea seleccionar?" groups="gt_government_procedure.group_administrative"/>
		<button name="%(action_cancel_process)d" states="recomended" groups="gt_government_procedure.group_administrative" string="Anular Solicitud" type="action" icon="gtk-cancel"/>
		<button name="%(action_cancel_process)d" states="done" groups="purchase.group_purchase_user" string="Anular Solicitud" type="action" icon="gtk-cancel"/>
		<button name="tender_done" states="select" confirm="Desea generar la Orden de compra??" string="Terminar Proceso" type="object" icon="gtk-jump-to" groups="purchase.group_purchase_user"/>
		<button name="print_solicitud" colspan="4" string="Imprimir Solicitud" states="in_progress,aproved,recomended,select,comprometed,done" type="object" icon="gtk-print"/>
		<button name="generate_line" colspan="4" string="Generar Lineas" states="start" type="object" icon="gtk-execute"/>
	  </group>
	</xpath>
	<notebook position="inside">
	  <page string="Autorización" groups="gt_government_procedure.group_administrative,purchase.group_purchase_user" 
		attrs="{'invisible': [('state', 'not in',('select','recomended','done'))]}">
	    <field colspan="4" name="purchase_select_ids" nolabel="1" mode="tree,form"
		   attrs="{'invisible': [('state', 'in',('draft','in_progress'))],'addable':[('state','!=','draft')],
			  'readonly': [('state', '!=','recomended')]}">
              <tree string="Cotizaciones">
		<field name="name" string="Reference"/>
		<field name="partner_id"/>
		<field name="select_item" invisible="1"/>
		<field name="amount_untaxed" string="B. IMPONIBLE" readonly="1"/>
		<field name="add_disc_amt" string="DESC."/>
		<field name="amount_tax" string="Tot. Imp(IVA+ICE+Verde)" readonly="1"/>
		<field name="amount_total" readonly="1"/>
		<button name="print_oc_req" string="Imprimir Orden Compra" 
			attrs="{'invisible': [('select_item', '=','False')]}" type="object" icon="gtk-print"/>
              </tree>
	      <form>
		<field name="name" readonly="1"/>
		<notebook colspan="4">
		  <page string="Cotización">
		    <field name="partner_id" readonly="1" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1,'default_supplier':1,'default_customer':0}"  options='{"quick_create": false}'/>
		    <field name="partner_address_id" readonly="1" options='{"quick_create": false}'/>
		    <field name="origin" readonly="1"/>
		    <field name="payment_term"/>
		    <field name="partner_incop_type" readonly="1"/>
		    <field name="lugar_entrega"/>
		    <field name="location_id" invisible="1"/>
		    <field name="pricelist_id" invisible="1"/>
		    <newline/>
		    <field colspan="4" name="order_line" nolabel="1" mode="tree"
			   attrs="{'addable':[('state','!=','draft')]}">
		      <tree string="Purchase Order Lines" editable="bottom">
			<field name="select"/>
			<field name="date_planned" string="Fecha Entrega" readonly="1"/>
			<!--field name="product_id" readonly="1" on_change="onchange_product_id(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,name,price_unit,notes,context)" required="1"/-->
			<field name="name" readonly="1"/>
			<field name="product_qty" readonly="1"/>
			<field name="product_uom" readonly="1"/>
			<field name="price_unit" readonly="1"/>
			<field name="price_subtotal"/>
			<field name="amount_tax"/>
			<field name="tot_included"/>
			<field name="state" invisible="1"/>
		      </tree>
		    </field>
		    <group col="7" colspan="4">
		      <field name="amount_untaxed" sum="Untaxed amount"/>
		      <field name="amount_tax" string="Tot. Imp(IVA+ICE+Verde)"/>
		      <field name="amount_total" sum="Total amount"/>
		      <newline/>
				  <!--button colspan="6" name="button_dummy" string="Calcular" type="object" icon="gtk-execute"/-->
				  <button colspan="1" name="calcular_valores" string="Calcular" type="object"  icon="gtk-execute"/>
		    </group>
		    <field name="state" invisible="1" widget="statusbar" statusbar_visible="draft,approved,done" statusbar_colors='{"except_picking":"red","except_invoice":"red","confirmed":"blue","wait":"blue"}' readonly="1"/>
		  </page>
		  <page string="Otra Información">
				<group string="Producto">
				  <field name="in_stock" readonly="1"/>
				  <field name="procedencia" readonly="1"/>
				  <field name="tipo" readonly="1"/>
				</group>
				<group string="Plazo">
				  <field name="tiempo_entrega" readonly="1"/>
				  <field name="dias_credito" readonly="1"/>
				  <field name="garantia" readonly="1"/>
				  <field name="validez" readonly="1"/>
				</group>
			  </page>
			  <page string="Observaciones">
				<field name="notes" nolabel="1" readonly="1"/>
			  </page>
			</notebook>
		  </form>
		</field>
		<button name="print_cuadro_aut" colspan="2" string="Imprimir cuadro comparativo autorizado" states="aproved,recomended,select,comprometed,done" type="object" icon="gtk-print"/>
		<separator string="Criterio Autorización" colspan="4"/>
		<field name="criterio_sel" nolabel="1" 
			   attrs="{'readonly': [('state', '!=','recomended')],'required': [('state', '=','recomended')]}" colspan="4"/>
	  </page>
	  <page string="Justificativo">
	    <field name="asunto"/>
            <field name="justificativo" colspan="4" nolabel="1" attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
	  </page>
	  <page string="Observaciones">
            <field name="description" colspan="4" nolabel="1"/>
	  </page>
	  <page string="Historial">
		<field colspan="4" name="log_ids" nolabel="1" readonly="1">
          <tree string="Historial">
			<field name="date"/>
			<field name="name"/>
			<field name="action"/>
			<field name="desc" required="1"/>
		  </tree>
		</field>
	  </page>
	</notebook>
	<xpath expr="/form/notebook/page[@string='Quotations']/group[@col='8']/button[@type='action']" position="replace">
	  <button name="%(purchase_requisition.action_purchase_requisition_partner)d" string="Solicitar Cotización" type="action" icon="gtk-execute"
              attrs="{'invisible': [('state', '!=', 'aproved')]}" />
	</xpath>
	<xpath expr="/form/notebook/page[@string='Quotations']" position="replace">
	  <page string="Registro de cotizaciones" attrs="{'invisible': [('state','not in', ('aproved','recomended','select','comprometed','done'))]}" 
		groups="purchase.group_purchase_user,gt_government_procedure.group_administrative">
	    <button name="print_solicitud_proveedor" colspan="2" string="Imprimir Solicitud a Proveedor" states="aproved,recomended,select,comprometed,done" 
		    type="object" icon="gtk-print"/>
	    <field name="iva" colspan="2"/>
	    <newline/>
	    <button name="%(purchase_requisition.action_purchase_requisition_partner)d" colspan="2" 
		    states="aproved" string="Registrar Cotización" type="action" icon="gtk-execute"/>
	    <field colspan="4" name="purchase_ids" nolabel="1" mode="tree,form"
		   attrs="{'invisible': [('state', 'in',('draft','in_progress'))],'addable':[('state','!=','draft')],
			  'readonly': [('state', '!=','aproved')]}" context="{'band':True}">
	      <tree string="Cotizaciones">
		<field name="name" string="Reference"/>
		<!--field name="date_order" string="Order Date"/-->
		<field name="partner_id"/>
		<!--field name="number_select"/-->
		<field name="select_item"/>
		<!--field name="minimum_planned_date"/-->
		<field name="amount_untaxed" string="B. IMPONIBLE" readonly="1"/>
		<field name="add_disc_amt" string="DESC."/>
		<field name="amount_tax" readonly="1" string="Tot. Imp(IVA+ICE+Verde)"/>
		<field name="amount_total" readonly="1"/>
	      </tree>
	      <form>
		<field name="name" readonly="1"/>
		<field name="was_recomended" invisible="1"/>
		<button colspan="1" name="seleccionar_requisition" string="Seleccionar/No Seleccionar" type="object"  icon="gtk-ok"
				attrs="{'readonly': [('was_recomended', '=',True)]}"/>
		<notebook colspan="4">
		  <page string="Purchase Order">
		    <field name="partner_id" readonly="1" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1,'default_supplier':1,'default_customer':0}"  options='{"quick_create": false}'/>
		    <field name="partner_address_id" readonly="1" options='{"quick_create": false}'/>
		    <field name="origin" readonly="1"/>
		    <field name="payment_term" invisible="1"/>
		    <field name="partner_incop_type" invisible="1"/>
		    <field name="lugar_entrega"/>
		    <field name="location_id" invisible="1"/>
		    <field name="pricelist_id" invisible="1"/>
		    <!--button name="load_product" string="Cargar Productos" type="object" icon="gtk-apply"/>
			<button name="select_all" string="Seleccionar todo" type="object" icon="gtk-apply"/>
			<button name="quit_all" string="Desmarcar todo" type="object" icon="gtk-cancel"/-->
		    <newline/>
		    <field colspan="4" name="order_line" nolabel="1" mode="tree" editable="bottom"
			   attrs="{'addable':[('state','!=','draft')]}">
		      <tree string="Purchase Order Lines" editable="bottom">
			<field name="select"/>
			<!--field name="product_id" readonly="1"  MARIO/-->
			<field name="name" readonly="1"/>
			<field name="tax_type"/>
			<!--field name="date_planned" string="Fecha Entrega"/>
			<field name="product_id" readonly="1" on_change="onchange_product_id(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,name,price_unit,notes,context)" required="1"/-->
			<field name="name" readonly="1" invisible="1"/>
			<!--field name="product_uom" readonly="1"/-->
			<field name="product_qty" readonly="1"/>			
			<field name="price_unit" />
			<field name="price_subtotal_s" sum="SUBTOTAL"/>
			<field name="amount_tax" sum="IMPUESTOS"/>
			<field name="tot_included" sum="TOTAL"/>
		      </tree>
		    </field>
		    <group col="7" colspan="4">
		      <!--field name="amount_untaxed" sum="Untaxed amount"/>
			  <field name="amount_tax"/>
			  <field name="amount_total" sum="Total amount"/-->
		      <field name="amount_untaxed" sum="Total BI"/>
		      <field name="add_disc"/>
		      <field name="add_disc_amt"/>
		      <field name="amount_net"/>
		      <field name="iva_value"/>
		      <field name="ice_value" />
		      <field name="imp_verde"/>
		      <field name="amount_tax" string="Tot. Imp(IVA+ICE+Verde)"/>
		      <field name="amount_total"/>
			  <newline/>
		      <!--button colspan="1" name="button_dummy" string="Calcular" type="object" icon="gtk-execute"/-->
		      <button colspan="1" name="calcular_valores" string="Calcular" type="object"  icon="gtk-execute"/>
		    </group>
		    <field name="state" widget="statusbar" invisible="1" statusbar_visible="draft,approved,done" statusbar_colors='{"except_picking":"red","except_invoice":"red","confirmed":"blue","wait":"blue"}' readonly="1"/>
		  </page>
		  <page string="Otra Información">
		    <group string="Producto">
		      <field name="in_stock"/>
		      <field name="procedencia" required="1"/>
		      <field name="tipo" required="1"/>
				</group>
				<group string="Plazo">
				  <field name="tiempo_entrega" required="1"/>
				  <field name="dias_credito" required="1"/>
				  <field name="garantia" required="1"/>
				  <field name="validez" required="1"/>
				</group>
			  </page>
			  <page string="Observaciones">
				<field name="notes" nolabel="1"/>
			  </page>
			</notebook>
		  </form>
		</field>
		<button name="print_cuadro" colspan="2" string="Imprimir cuadro comparativo" 
				states="aproved,recomended,select,comprometed,done" type="object" icon="gtk-print"/>
		<field name="total_cotizaciones"/>
		<separator string="Criterio Recomendación" colspan="4"/>
		<field name="criterio_rec" nolabel="1" colspan="4" 
			   attrs="{'readonly': [('state', '!=','aproved')],'required': [('state', '=','aproved')]}"/>		
	  </page>
	</xpath>
  </field>
</record>

<record model="ir.ui.view" id="purchase_req_search_inherit">
  <field name="name">purchase.req.list.select.inherit</field>
  <field name="type">form</field>
  <field name="model">purchase.requisition</field>
  <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_filter"/>
  <field name="arch" type="xml">
    <xpath expr="/search/group/filter[@string='Responsible']" position="after">
      <separator orientation="vertical"/>
      <filter string="Departamento" icon="terp-personal" domain="[]" context="{'group_by':'department_id'}"/>
	</xpath>
  </field>
</record>

<!--
MENUS DE BORRADOR Y PROCESO
-->


<record model="ir.actions.act_window" id="action_purchase_requisition_all">
  <field name="name">Todas</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_all"
   sequence="1"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_all"/>

<record model="ir.actions.act_window" id="action_purchase_requisition_aprobe">
  <field name="name">Aprobar</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('in_progress'))]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<!--menuitem
   id="menu_purchase_requisition_aprobe"
   sequence="2"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_aprobe"/-->


<record model="ir.actions.act_window" id="action_purchase_requisition_recomendar">
  <field name="name">Registrar Cotización</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('aproved'))]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_recomendar"
   sequence="3"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_recomendar"/>

<menuitem
   id="menu_purchase_requisition_anular_compras"
   sequence="100"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_requisition_cancel"/>

<record model="ir.actions.act_window" id="action_purchase_requisition_comprometer">
  <field name="name">Autorizar C</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('recomended'))]</field>
  <!--field name="search_view_id" ref="view_purchase_requisition_filter_2"/-->
</record>

<!--menuitem
   id="menu_purchase_requisition_comprometer"
   sequence="4"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_comprometer"/-->

<record model="ir.actions.act_window" id="action_purchase_requisition_finalizar">
  <field name="name">Finalizar</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('select'))]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_finalizar"
   sequence="4"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_finalizar"/>

<record model="ir.actions.act_window" id="action_purchase_requisition_cancel">
  <field name="name">Anuladas</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('cancel'))]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<!--menuitem
   id="menu_purchase_requisition_cancel"
   sequence="6"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   action="action_purchase_requisition_cancel"/-->

<!-- MENU DE SOLICITUDES DE COMPRA EN GESTION DOCUMENTAL
-->



<menuitem id="menu_parent_purchase_document" parent="menu_purchase_requisition_document" 
		  name="Solicitudes de compra" sequence="1"/>


<!-- LAS Q SOY SOLICITANTE
-->
<record model="ir.actions.act_window" id="action_purchase_requisition_solicitant">
  <field name="name">Solicitadas por mi</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','!=',('done','cancel')),('usr_solicitant_id','=',uid)]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_3"/>
</record>

<!--menuitem
   id="menu_purchase_requisition_document_solicitant"
   sequence="3"
   groups="group_purchase_solicitant"
   parent="menu_purchase_requisition_document"
   action="action_purchase_requisition_solicitant"/-->

<!--    -->

<!-- LAS Q SOY SOLICITANTE
-->
<record model="ir.actions.act_window" id="action_purchase_requisition_anulant_me">
  <field name="name">Anuladas por mi</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('anulant_id','=',uid)]</field>
</record>

<!--menuitem
   id="menu_purchase_requisition_document_anulant_me"
   sequence="3"
   groups="group_purchase_basic"
   parent="menu_purchase_requisition_document"
   action="action_purchase_requisition_anulant_me"/-->

<!-- VISTA DE OCS EN DOCUMENTAL   -->

<record model="ir.actions.act_window" id="action_oc_alone">
  <field name="name">Ordenes de compra</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.order</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree</field>
  <field name="domain">[('solicitant_id','=',uid)]</field>
  <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
</record>

<menuitem
   id="menu_oc_document_tree"
   sequence="100"
   groups="group_purchase_basic"
   parent="menu_purchase_requisition_document"
   action="action_oc_alone"/>
<!-- -->
<record model="ir.actions.act_window" id="action_oc_stock">
  <field name="name">Actas Entrega Recepcion</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.order</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree</field>
  <field name="domain">[('select','=',True),('is_finish','=',True)]</field>
  <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
</record>

<menuitem
   id="menu_oc_sock_tree"
   sequence="100"
   groups="stock.group_stock_manager"
   parent="stock.menu_stock_warehouse_mgmt"
   action="action_oc_stock"/>
<!--    -->

<record model="ir.actions.act_window" id="action_purchase_requisition_alone">
  <field name="name">Todas</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <!--field name="domain">[('user_id','=',uid)]</field-->
  <!--field name="context">{"search_default_user_id":uid}</field-->
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_document_tree"
   sequence="3"
   groups="group_purchase_basic"
   parent="menu_purchase_requisition_document"
   action="action_purchase_requisition_alone"/>

<record model="ir.actions.act_window" id="action_purchase_requisition_alone_progress">
  <field name="name">Solicitud Compra</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('user_id','=',uid)]</field>
  <field name="context">{"search_default_user_id":uid}</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_document_tree_progress_alone"
   sequence="1"
   groups="group_purchase_basic,gt_document_manager.group_doc_user"
   parent="menu_purchase_requisition_document"
   action="action_purchase_requisition_alone_progress"/>


<!--record id="view_picking_alone_tree_2" model="ir.actions.act_window.view">
  <field eval="1" name="sequence"/>
  <field name="view_mode">tree</field>
  <field name="view_id" ref="stock.vpicktree"/>
  <field name="act_window_id" ref="action_picking_alone"/>
</record>

<record id="view_picking_alone_form_2" model="ir.actions.act_window.view">
  <field eval="2" name="sequence"/>
  <field name="view_mode">form</field>
  <field name="view_id" ref="view_requisition_picking_form"/>
  <field name="act_window_id" ref="action_picking_alone"/>
</record>

<record id="view_picking_alone_tree_3" model="ir.actions.act_window.view">
  <field eval="1" name="sequence"/>
  <field name="view_mode">tree</field>
  <field name="view_id" ref="stock.vpicktree"/>
  <field name="act_window_id" ref="action_picking_alone_aprobar"/>
</record>

<record id="view_picking_alone_form_3" model="ir.actions.act_window.view">
  <field eval="2" name="sequence"/>
  <field name="view_mode">form</field>
  <field name="view_id" ref="view_requisition_picking_form"/>
  <field name="act_window_id" ref="action_picking_alone_aprobar"/>
</record-->

<!--menuitem
   id="menu_document_picking_tree"
   sequence="3"
   groups="group_purchase_basic"
   parent="menu_purchase_requisition_document"
   action="action_picking_alone"/-->

<!-- MENUS DE DOCUMENTAL PARA APROBADORES Y AUTORIZADORES
-->

<record model="ir.actions.act_window" id="action_purchase_requisition_aprobe_documental">
  <field name="name">Aprobar</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=','in_progress')]</field>
  <field name="search_view_id" ref="view_purchase_requisition_filter_2"/>
</record>

<menuitem
   id="menu_purchase_requisition_aprobe_documental"
   sequence="2"
   parent="menu_purchase_requisition_document"
   groups="group_purchase_basic"
   action="action_purchase_requisition_aprobe_documental"/>

<record model="ir.actions.act_window" id="action_purchase_requisition_autorizar_documental">
  <field name="name">Autorizar</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=','recomended')]</field>
</record>

<menuitem
   id="menu_purchase_requisition_autorizar_documental"
   sequence="3"
   parent="purchase_requisition.menu_purchase_requisition_pro_mgt"
   groups="gt_government_procedure.group_administrative"
   action="action_purchase_requisition_autorizar_documental"/>

<!-- autorizar en el documental
-->

<record model="ir.actions.act_window" id="action_purchase_requisition_autorizar_documental_director">
  <field name="name">Autorizar </field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">purchase.requisition</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="domain">[('state','=',('recomended'))]</field>
</record>

<menuitem
   id="menu_purchase_requisition_autorizar_documental_director"
   sequence="3"
   parent="menu_purchase_requisition_document"
   groups="gt_government_procedure.group_administrative"
   action="action_purchase_requisition_autorizar_documental_director"/>

<!-- AGREGADO POR EL GAD 
     al hacer click se abren el formulario form y el tree, muestra las solicitudes del usuario de la direccion y los que estan dentro --> 
      <record id="action_purchase_requisition_unidad" model="ir.actions.act_window">
		<field name="name">Unidad/Dirección</field> <!--v la busqueda -->
		<field name="res_model">purchase.requisition</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
                <field name="domain">[('department_id','child_of',department_id)]</field> 
                     
      </record>
      <menuitem id="menu_purchase_requisition_unidad"  sequence="11" action="action_purchase_requisition_unidad"    
                parent="menu_purchase_requisition_document" groups="group_purchase_unidad" />

<delete model="ir.values" search="[('name','=','act_res_partner_2_purchase_order')]"/>

    </data>
</openerp>
