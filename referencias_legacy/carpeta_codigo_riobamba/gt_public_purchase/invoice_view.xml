<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>


<!-- NEW ACTION AND VIEW TO CONTRACT IN ACCOUNT
-->

<record model="ir.ui.view" id="view_supp_contract_form">
  <field name="name">DOC_CONTRACT_sup</field>
  <field name="model">doc_contract.contract</field>
  <field name="priority" eval="1"/>
  <field name="type">form</field>
  <field name="arch" type="xml">
    <form string="Contratos">
      <group colspan="4" col="6">
        <group colspan="6" string="Estado" col="2">
          <field name="state" widget="statusbar" statusbar_visible="draft,legalizing,open,execution,done" statusbar_colors='{"draft":"black","legalizing":"blue","open":"blue","execution":"blue","cancelled":"grey","done":"green"}' select="1"/>
		  <!--field name="state_covenant"/-->
        </group>
        <group colspan="6" string="Información General" col="8">
	      <field name="user_id" colspan="4" widget="selection"/>
		  <field name="creation_date" colspan="2"/>
		  <field name="expedient_id" string="Trámite" colspan="2" readonly="1"/>
          <field name="code" colspan="2" readonly="True" invisible="1" string="Código"/>
          <field name="codigo_contrato" colspan="2" required="True" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}"/>
          <field name="year" colspan="2" required="True" readonly="True"/>
	      <field name="subscription_date" colspan="2" required="True" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}"/>
	      <field name="name" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}" 
				 colspan="8"/>
		  <field name="partner_id" colspan="4" required="True" readonly="1"/>
		  <field name="department_id" required="True" colspan="4" readonly="1"/> 
		  <newline/>
	      <field name="amount" required="True" colspan="2" readonly="1"/>
	      <field name="percentage_advance" required="True" colspan="2" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}"/>
		  <field name="term" required="True" colspan="1" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}"/>
          <field name="fecha_cumplimiento" colspan="1" attrs="{'readonly':['|',('state','!=','execution'),('ejecucion','=',False)]}"/>
		  <!--field name="chk_create_expedient" attrs="{'readonly':['|',('state','!=','draft'),
													   ('owner','=',False)]}"/>
	      <field name="doc_contract_stage_id" widget="selection"/-->
	      <field name="owner" invisible="1"/>
	      <field name="admin_contract" invisible="1"/>
	      <field name="perfil_usuario" invisible="1"/>
	      <field name="info_general" invisible="1"/>
	      <field name="distribucion" invisible="1"/>
	      <field name="ejecucion" invisible="1"/>
	      <field name="not_perfil" invisible="1"/>
	      <field name="chk_zip" invisible="1"/>
		  <field name="chk_notify_admin" invisible="1"/>
		</group>
      </group>
      <notebook colspan="4">
	    <page string="Datos Relacionados">
	      <notebook colspan="4">       
			<page string="Proyección Pagos">
			  <field name="payment_term_id" required="True" colspan="2" 
					 attrs="{'readonly':['|',('state','!=','draft'),
							('owner','=',False)]}"/>
			  <newline/>
			  <field name="payment_lines" nolabel="1" colspan="4" 
					 attrs="{'readonly':[('state','!=','draft')]}" >
				<tree editable="bottom">
				  <field name="desc" required="1"/>
				  <field name="date" required="1"/>
				  <field name="amount" required="1"/>
				</tree>
			  </field>
			</page>   	
		    <page string="Referencia de Trámites">
	          <field name="expedient_ids" nolabel="1" widget="many2many" colspan="6"
	                 attrs="{'readonly':['|',('not_perfil','=',True),('distribucion','=',True)]}">
	            <tree editable="bottom">
	              <field name="code" readonly="True"/>
	              <field name="name" readonly="True"/>
	              <field name="resumen" readonly="True"/>
	            </tree>	
	          </field>
		    </page>
			<page string="Garantias">
			  <group col="3" colspan="2">
			    <field name="warranty_ids" readonly="True" nolabel="1">
			      <tree editable="top">
			        <field name="type_warranty_id"/>
			        <field name="amount"/>
			      </tree>
			    </field>
			  </group>    
			</page>
			<page string="Solicitudes de pago">
			  <field name="pay_ids" readonly="1" nolabel="1"/>
			</page>
			<page string="Docs. Presupuestarios">
			  <field name="prf_ids" readonly="1" nolabel="1"/>
			</page>
			<page string="Facturas">
			  <group>
				<field name="invoice_ids" nolabel="1" readonly="1" colspan="4"/>
			  </group>
			  <newline/>
			  <group>
				<field name="amount_total_invoice"/>
				<field name="amount_extra"/>
			  </group>
			</page>
	      </notebook>
	    </page>
		<page string="Observaciones">
	      <field name="notes" colspan="6" nolabel="1" 
				 attrs="{'readonly':['|',('state','!=','draft'),('owner','=',False)]}"/>
	    </page>
	    <page string="Historial">
	      <field name="historial_lines" nolabel="1" readonly="True"/>    
	    </page>
      </notebook>
    </form>
  </field>
</record>		

<record model="ir.actions.act_window" id="action_supplier_contract">
  <field name="name">Contratos</field>
  <field name="type">ir.actions.act_window</field>
  <field name="res_model">doc_contract.contract</field>
  <field name="view_type">form</field>
  <field name="view_mode">tree,form</field>
  <field name="search_view_id" ref="gt_doc_contract.view_doc_contract_search"/>
</record>

<record id="view_supp_contract_tree_invoice" model="ir.actions.act_window.view">
  <field name="view_mode">tree</field>
  <field name="view_id" ref="gt_doc_contract.view_doc_contract_tree"/>
  <field name="act_window_id" ref="action_supplier_contract"/>
</record>

<record id="view_supp_contract_form_invoice" model="ir.actions.act_window.view">
  <field name="view_mode">form</field>
  <field name="view_id" ref="view_supp_contract_form"/>
  <field name="act_window_id" ref="action_supplier_contract"/>
</record>

<menuitem id="menu_account_supplier_contract" name="Contratos"
          parent="account.menu_finance_payables"
          action="action_supplier_contract" sequence="201"
		  groups="account.group_account_user,account.group_account_manager"/>


    </data>
</openerp>

