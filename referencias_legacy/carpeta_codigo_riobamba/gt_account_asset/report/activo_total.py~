# -*- coding: utf-8 -*-
##############################################################################
#
# Mario Chogllo
# mariofchogllo@gmail.com
#
##############################################################################
import time
from report import report_sxw
from osv import fields, osv
from gt_tool import XLSWriter
import re

class activo_total(report_sxw.rml_parse):
    def __init__(self, cr, uid, name, context):
        super(activo_total, self).__init__(cr, uid, name, context=context)
        self.localcontext.update({
            'time': time,
            'cr':cr,
            'uid': uid,
            'get_categories_total': self.get_categories_total,
            'get_activos_total':self.get_activos_total,
        })

    def get_activos_total(self, this, categ_id):
        asset_obj = self.pool.get('account.asset.asset')
        asset_ids = asset_obj.search(self.cr, self.uid, [('category_id','=',categ_id),('employee_id','=',this.employee_id.id)])
        return asset_obj.browse(self.cr, self.uid,asset_ids)

    def get_categories_total(self,this):
        categ_ids1 = []
        asset_obj = self.pool.get('account.asset.asset')
        categ_obj = self.pool.get('account.asset.category')
        categ_ids = categ_obj.search(self.cr, self.uid, [])
        for categ_id in categ_ids:
            asset_ids = asset_obj.search(self.cr, self.uid, [('category_id','=',categ_id),('employee_id','=',this.employee_id.id)],limit=1)
            if asset_ids:
                if not categ_id in categ_ids1:
                    categ_ids1.append(categ_id)
        return categ_obj.browse(self.cr, self.uid,categ_ids1)
       
report_sxw.report_sxw('report.activo_total',
                       'activo.total', 
                       'addons/gt_account_asset/report/activo_total.mako',
                       parser=activo_total,
                       header=False)

